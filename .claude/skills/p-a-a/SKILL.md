---
name: p-a-a
description: 该技能用于分析代码库以了解其业务目的、技术栈，以及每个技术组件如何解决特定的业务或技术需求。当用户请求项目架构分析、技术栈文档或架构图时使用此技能。该技能生成详细的 PlantUML 架构图，展示组件关系和技术映射。
---

# 项目架构分析器

## 概述

该技能提供了分析软件项目的完整工作流程，以了解其业务目的、识别技术栈，并映射每项技术如何解决特定的业务或技术问题。分析结果生成详细的 PlantUML 架构图，适用于技术文档、利益相关者演示和入职培训材料。

## 使用场景

在以下情况下调用此技能：
- 用户请求分析项目的架构或技术栈
- 用户询问"这个项目是做什么的？"或"这个项目是如何构建的？"
- 用户需要用于文档或演示的架构图
- 用户想要了解业务需求与技术实现之间的关系
- 用户请求对未知代码库进行高级或详细的技术概述

## 分析工作流程

按顺序执行此工作流程以生成完整的架构分析：

### 步骤 1：项目发现和上下文收集

首先探索项目结构以了解其范围和目的：

1. **识别项目类型**：确定它是 Web 应用、CLI 工具、库、API 服务、数据管道等
2. **定位关键入口点**：查找主文件，如 `main.py`、`index.js`、`app.py`、`pom.xml`、`package.json`、`go.mod` 等
3. **读取配置文件**：检查 `README.md`、`docker-compose.yml`、`config/` 目录、环境文件
4. **识别构建系统**：注意 Maven、Gradle、npm、pip、Poetry、Go modules 等
5. **检查文档**：查找 `docs/`、`ARCHITECTURE.md`、`CONTRIBUTING.md`、API 规范

**输出**：项目类型、主要语言和初始目的假设的摘要。

### 步骤 2：业务功能分析

分析代码库以了解其解决的业务问题：

1. **检查领域模型**：在 `models/`、`entities/`、`domain/` 中查找实体、模型、模式
2. **识别核心服务**：在 `services/`、`handlers/`、`controllers/`、`use-cases/` 中查找业务逻辑
3. **分析 API 端点**：对于 Web 服务，审查路由、控制器和 API 定义
4. **审查测试用例**：测试通常揭示预期的业务行为
5. **检查领域特定术语**：注意命名中的行业术语、业务概念

**需要回答的问题**：
- 该项目解决了什么用户需求？
- 核心业务操作是什么？
- 主要用户/利益相关者是谁？
- 系统提供什么价值？

**输出**：用业务术语描述系统功能的业务功能摘要。

### 步骤 3：技术栈识别

系统地识别项目中使用的所有技术：

1. **语言和运行时**：从构建文件、解释器、编译器中记录版本
2. **框架**：识别 Web 框架（Django、Flask、Spring Boot、Express、FastAPI 等）
3. **数据库**：查找数据库驱动、ORM（SQLAlchemy、Hibernate、Prisma、TypeORM）
4. **消息队列/代理**：查找 Redis、RabbitMQ、Kafka 集成
5. **缓存**：识别 Redis、Memcached、内存缓存使用
6. **搜索引擎**：查找 Elasticsearch、Solr 集成
7. **存储**：注意 S3、文件系统、Blob 存储使用
8. **认证/授权**：查找 OAuth、JWT、会话管理、RBAC
9. **前端**：识别 React、Vue、Angular、模板、静态资源
10. **DevOps/基础设施**：查找 Docker、Kubernetes、Terraform、CI/CD 配置
11. **监控/日志**：检查 Prometheus、Grafana、ELK、Sentry
12. **测试框架**：注意 pytest、JUnit、Jest、测试夹具

**参考** `references/technology_mapping.md` 了解常见技术模式及其典型用例。

**输出**：按类别组织的完整技术栈（后端、数据库、前端、基础设施等）。

### 步骤 4：技术-问题映射

对于识别的每项技术，解释选择它的原因以及它解决的问题：

**分析模板**：
```
技术：[名称]
类别：[类别]
解决的业务问题：[这解决了什么用户需求或业务要求？]
解决的技术问题：[这解决了什么技术挑战？]
未选择的替代方案：[存在哪些替代方案，为什么选择此方案？]
```

**需要识别的常见模式**：
- **Redis 用于缓存** → 解决性能问题，减少数据库负载
- **消息队列** → 解耦服务，处理异步处理
- **ORM 框架** → 抽象数据库复杂性，提高开发人员生产力
- **JWT 认证** → 实现无状态 API 认证
- **Docker 容器** → 确保环境一致性，简化部署

**输出**：每项技术与其业务/技术理由的映射。

### 步骤 5：组件关系分析

了解系统的不同部分如何交互：

1. **数据流**：跟踪数据在系统中的移动（输入 → 处理 → 存储 → 输出）
2. **服务边界**：识别独立的服务、模块或组件
3. **外部集成**：注意第三方 API、外部服务
4. **异步进程**：查找后台作业、计划任务、事件处理器
5. **安全边界**：识别认证、授权、加密点

**输出**：组件交互和数据流的描述。

### 步骤 6：架构图生成

生成显示系统架构的 PlantUML 图：

#### 6.1 高级架构图

使用 `assets/high_level_architecture.puml` 中的模板创建鸟瞰图，显示：
- 外部参与者（用户、外部系统）
- 主要系统组件
- 数据存储
- 关键集成

#### 6.2 详细组件图

使用 `assets/detailed_component.puml` 中的模板显示：
- 单个服务/模块
- 数据库模式
- API 端点
- 内部通信模式

#### 6.3 技术栈图

使用 `assets/technology_stack.puml` 中的模板显示：
- 分层架构（表示层、应用层、领域层、数据层）
- 每层的技术选择
- 技术交互

**图指南**：
- 为所有组件包含清晰的标签
- 使用箭头显示数据流和依赖关系
- 为不同层或组件类型使用颜色编码
- 添加解释符号和缩写的图例
- 确保图表适合标准文档宽度

### 步骤 7：报告编译

编译最终分析报告，结构如下：

```markdown
# 项目架构分析：[项目名称]

## 执行摘要
[描述项目业务目的的 2-3 句话]

## 业务功能
[系统功能的详细描述]

## 技术栈
[按类别组织的技术列表]

## 技术-问题映射
[解释每项技术目的的表格或列表]

## 架构概述
[系统架构和组件关系的描述]

## 架构图
[PlantUML 图表]

## 关键技术决策
[值得注意的架构模式、设计选择及其理由]

## 建议
[关于技术债务、改进机会或架构问题的任何观察]
```

**重要**：使用 Bash 工具执行 `mkdir -p {项目根目录}/doc` 确保 doc 目录存在，然后将报告写入 `{项目根目录}/doc/architecture_analysis.md`。

## 资源

### assets/

用于生成架构图的 PlantUML 模板：

- `high_level_architecture.puml` - 高级系统概述模板
- `detailed_component.puml` - 详细组件关系模板
- `technology_stack.puml` - 分层技术栈图模板

这些模板提供了图生成的起点。根据项目复杂性和利益相关者需求进行自定义。

### references/

- `technology_mapping.md` - 常见技术及其典型用例、解决的问题和替代方案的综合参考。使用此参考快速识别选择特定技术的原因以及它们满足的业务/技术需求。

## 有效分析技巧

1. **从广度开始，然后深入**：从项目结构开始，然后检查特定组件
2. **跟随数据**：跟踪数据流以了解系统行为
3. **查找模式**：识别常见架构模式（分层、微服务、事件驱动）
4. **问为什么**：不仅要识别技术——还要了解选择背后的理由
5. **记录假设**：注意何时推断目的与何时明确说明
6. **使用代码作为真相**：根据实际代码实现验证文档
7. **考虑上下文**：不同的项目有不同的约束（规模、团队大小、领域）
